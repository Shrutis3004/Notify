'use strict';

var Joi = require('joi');

var Utils = require('../utils');

var _require = require('../validators'),
    CreateAppSchema = _require.CreateAppSchema,
    IdSchema = _require.IdSchema,
    EditAppSchema = _require.EditAppSchema;

module.exports = function (axios) {
  return {
    /**
     * Get all OneSignal apps
     *
     * @param {Function} callback Callback function for backwards compatibility
     * @returns {Promise}
     */
    getApps: function getApps(callback) {
      if (!callback || !Utils.isFunction(callback)) {
        callback = function callback() {};
      }

      return axios.get('/apps').then(function (response) {
        callback(null, response.data);
        return response.data;
      }).catch(function (err) {
        callback(err, null);
        return err;
      });
    },


    /**
     * Get details of a OneSignal app
     *
     * @param {String} id Id of the app
     * @param {Function} callback Callback function for backwards compatibility
     * @returns {Promise}
     */
    getApp: function getApp(id, callback) {
      var _Joi$validate = Joi.validate(id, IdSchema),
          error = _Joi$validate.error;

      if (error) {
        throw error;
      }

      if (!callback || !Utils.isFunction(callback)) {
        callback = function callback() {};
      }
      return axios.get('/apps/' + id).then(function (response) {
        callback(null, response.data);
        return response.data;
      }).catch(function (err) {
        callback(err, null);
        return err;
      });
    },


    /**
     * Create a OneSignal app
     *
     * @param {App} data App Object see https://documentation.onesignal.com/reference#create-an-app
     * @param {Function} callback Callback function for backwards compatibility
     * @returns {Promise}
     */
    createApp: function createApp(data, callback) {
      var _Joi$validate2 = Joi.validate(data, CreateAppSchema),
          error = _Joi$validate2.error;

      if (error) {
        throw error;
      }

      if (!callback || !Utils.isFunction(callback)) {
        callback = function callback() {};
      }
      return axios.post('/apps', data).then(function (response) {
        callback(null, response.data);
        return response.data;
      }).catch(function (err) {
        callback(err, null);
        return err;
      });
    },


    /**
     * Edit a OneSignal app
     *
     * @param {String} id
     * @param {App} data App Object see https://documentation.onesignal.com/reference#create-an-app
     * @param {Function} callback Callback function for backwards compatibility
     * @returns {Promise}
     */
    editApp: function editApp(id, data, callback) {
      var idError = Joi.validate(id, IdSchema).error;

      if (idError) {
        throw idError;
      }

      var appError = Joi.validate(data, EditAppSchema).error;

      if (appError) {
        throw appError;
      }

      if (!callback || !Utils.isFunction(callback)) {
        callback = function callback() {};
      }
      return axios.put('/apps', data).then(function (response) {
        callback(null, response.data);
        return response.data;
      }).catch(function (err) {
        callback(err, null);
        return err;
      });
    }
  };
};